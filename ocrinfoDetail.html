<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>OCR情報詳細 | Japrs+</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="container">
    <h2>OCR情報詳細</h2>
    <div style="display: flex; height: 90vh;">
      <!-- 左側：PDF表示 -->
      <iframe id="pdfViewer" style="width: 50%; height: 100%;" frameborder="0"></iframe>
      <!-- 右側：OCRテキストやタイトル表示 -->
      <div style="width: 50%; padding: 20px;">
        <h3 id="title"></h3>
        <pre id="ocrText"></pre>
      </div>
    </div>
  </div>
  <script>
    // クエリパラメータを取得する関数
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // クエリパラメータから値を取得
    $(function() {
      const filename = getQueryParam("filename");
      const id = getQueryParam("id");

      // API呼び出しで詳細データを取得
      $.ajax({
        url: "https://5jd5ld5ax4.execute-api.ap-northeast-1.amazonaws.com/ocrinfo/detail?id=" + encodeURIComponent(id),
        method: "GET",
        headers: {
          Authorization: localStorage.getItem("idToken"),
        },
        success: function(data) {
          $("#title").text(data.title || "");
          $("#ocrText").text(data.execresult || "");
          if (data.filename) {
            $("#pdfViewer").attr("src", "https://japrs-s3-pdfupload-tnc-dev.s3.ap-northeast-1.amazonaws.com/" + encodeURIComponent(data.filename));
          }
        },
        error: function(jqXHR) {
          alert("データ取得に失敗しました: " + jqXHR.responseJSON.message);
        }
      });
    });
  </script>
</body>
</html>